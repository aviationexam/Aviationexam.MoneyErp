parameters:
  - name: file
    type: string
  - name: fileExt
    type: string
    default: ''
  - name: stepName
    type: string

steps:
  - bash: |
      set -euo pipefail

      if [[ -n '${{ parameters.file }}' ]]; then
        FILE=$(mktemp "$(Agent.TempDirectory)/param-XXXXXX.${{ parameters.fileExt }}")
        echo "Parameter stored into $FILE"

        echo '${{ parameters.file }}' | base64 -d > "$FILE"

        # Make it available to subsequent steps in the same job
        echo "##vso[task.setvariable variable=file_path]$FILE"
        echo "##vso[task.setvariable variable=file_path;isOutput=true]$FILE"
      fi
    name: ${{ parameters.stepName }}
    displayName: 'Persist parameter content as file'
